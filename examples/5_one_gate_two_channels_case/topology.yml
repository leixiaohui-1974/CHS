# System topology for Case 5: Mixed PID Control

components:
  - name: upstream_inflow
    type: Disturbance
  - name: downstream_demand
    type: Disturbance

  - name: upstream_channel
    type: MuskingumChannelModel
    properties: {K: 5.0, x: 0.1, dt: 1.0, initial_inflow: 10.0, initial_outflow: 10.0}
    connections: {inflow: upstream_inflow.output}

  - name: pid_upstream
    type: PIDController
    connections: {measured_value: upstream_channel.output}

  - name: pid_downstream
    type: PIDController
    connections: {measured_value: downstream_channel.output}

  - name: pid_combiner
    type: SummingPoint
    connections: [pid_upstream.output, pid_downstream.output]
    gains: [0.5, 0.5]

  - name: gate
    type: GateStationModel
    properties: {num_gates: 1, gate_width: 1.0, discharge_coeff: 0.6}
    connections:
      upstream_level: upstream_channel.output
      gate_opening: pid_combiner.output

  - name: net_inflow_calculator
    type: SummingPoint
    connections: [gate.output, downstream_demand.output]
    gains: [1, -1]

  - name: downstream_channel
    type: MuskingumChannelModel
    properties: {K: 8.0, x: 0.06, dt: 1.0, initial_inflow: 8.0, initial_outflow: 8.0}
    connections: {inflow: net_inflow_calculator.output}

logging:
  - time
  - upstream_channel.output
  - downstream_channel.output
  - gate.output
  - upstream_inflow.output
  - downstream_demand.output
