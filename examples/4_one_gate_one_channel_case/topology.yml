# System topology for Case 4: One Gate, One Channel
# Controller properties are defined in control_parameters.yaml

components:
  - name: inflow_to_channel
    type: Disturbance
    properties:
      signal_type: "constant"
      value: 10.0

  - name: channel
    type: ChannelEntity
    properties: {} # No entity-level properties for now

    # Define the three fidelity models for the channel
    steady_model:
      type: SteadyChannelModel
      properties: {} # No params for the placeholder

    dynamic_model:
      type: MuskingumChannelModel
      properties:
        K: 5.0
        x: 0.1 # Corrected for stability
        dt: 1.0
        initial_inflow: 10.0
        initial_outflow: 10.0
      connections:
        inflow: inflow_to_channel.output

    precision_model:
      type: StVenantModel
      properties: {} # No params for the placeholder

  - name: pid_controller
    type: PIDController
    connections:
      measured_value: channel.output

  - name: gate
    type: GateStationModel
    properties:
      num_gates: 1
      gate_width: 1.0 # Assuming a gate width of 1m
      discharge_coeff: 0.6
    connections:
      upstream_level: channel.output
      # Note: The original 'downstream_level' is not a direct input to the new model,
      # as it now calculates free-flow based on upstream level only.
      # This simplifies the model as per the new design. A more complex
      # submerged flow model could be added later if needed.
      gate_opening: pid_controller.output

logging:
  - time
  - channel.output
  - gate.output
  - pid_controller.output
  - inflow_to_channel.output
