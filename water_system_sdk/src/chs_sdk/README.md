# CHS-SDK：一个用于水务系统仿真与控制的综合工具包

欢迎使用 `chs-sdk`，这是一个功能强大且灵活的、基于Python的软件开发工具包（SDK），专为水务系统的仿真、分析和智能控制而设计。

## 概览

`chs-sdk` 采用双层架构设计：

1.  **核心科学计算引擎 (`modules/`)**: SDK 的核心提供了一套强大的工具集，用于创建水务系统的高保真数字孪生。该层专注于精确建模水流的物理过程，从流域的降雨径流过程到河流渠道中复杂的水动力学。它回答了这样一个问题：*“如果……将会发生什么？”*

2.  **智能体框架 (`agents/`, `factory/`, 等)**: 构建在核心引擎之上，该层提供了一个完整的框架，用于开发、训练和部署能够做出决策并控制仿真水系统的智能体。它回答了这样一个问题：*“接下来我们该怎么做？”*

这种双层设计实现了清晰的关注点分离，使得该SDK适用于从纯科学研究到开发实时自主控制系统的广泛应用。

## 目录结构与关键组件

以下是 `chs-sdk` 中主要目录及其功能的明细：

*   `main.py`
    *   **目的**: 运行仿真的主入口点。
    *   **关键组件**: 解析配置文件，设置仿真环境，并启动仿真循环。

*   `simulation_manager.py`
    *   **目的**: 协调整个仿真过程。
    *   **关键组件**: 管理仿真时间，协调智能体和模型的执行，并处理数据记录。

*   `config_parser.py`
    *   **目的**: 处理仿真配置文件的加载和验证。
    *   **关键组件**: 确保仿真是基于有效的参数和正确的拓扑结构设置的。

### `agents/` - 系统的大脑

该目录包含了决策和控制的逻辑。

*   **`base.py`**: 定义了 `BaseAgent`，所有智能体的基础构建模块。它为智能体生命周期管理（`setup`, `execute`, `shutdown`）、消息处理和状态管理提供了通用接口。
*   **`control_agent.py`**: 实现了 `ControlAgent`，负责控制仿真中的执行器（如闸门、水泵、阀门）。它可以搭载各种控制算法，如PID或MPC。
*   **`perception_agent.py`**: 负责从仿真中的传感器收集和处理数据，以形成对系统状态的连贯理解。
*   **`dispatch_agent.py`**: 一个更高级别的智能体，基于系统范围的策略来协调多个其他智能体的行动。
*   **`message.py` & `message_bus.py`**: 这些文件定义了允许智能体之间交换信息和命令的通信系统。

### `modules/` - 科学计算核心

这是数字孪生引擎，包含了所有基于物理的模型。

*   **`hydrology/`**: 用于模拟流域级别水文循环的模型。
    *   **`core.py`**: 包含水文仿真的主要编排逻辑，包括 `Basin`、`SubBasin` 和 `Reservoir` 类。
    *   **径流模型 (Runoff Models)**: 实现不同的模型来计算降雨产生的径流（例如 `XinanjiangModel`）。
    *   **汇流模型 (Routing Models)**: 实现模型来演算河道中的水流（例如 `MuskingumModel`）。
*   **`hydrodynamics/`**: 用于模拟明渠和管网中详细水流的模型，基于流体力学原理。
    *   **`solver.py`**: 包含用于求解圣维南方程（控制明渠水流）的数值求解器。
    *   **`network.py`**: 用于构建和管理节点与河段网络的工具。
*   **`modeling/`**: 一个全面的组件模型库，可以组装起来创建一个完整的系统模型。
    *   **`storage_models.py`**: 水库、水箱等蓄水模型的合集。
    *   **`channel_models.py`**: 河流和渠道段的模型。
    *   **`control_structure_models.py`**: 闸门、堰等控制建筑物的模型。
    *   **`pump_models.py`, `valve_models.py`**: 各类执行器的模型。
*   **`control/`**: 包含了各种控制算法的实现。
    *   **`pid_controller.py`**: 标准的比例-积分-微分（PID）控制器。
    *   **`mpc_controller.py`**: 用于更高级、优化控制的模型预测控制（MPC）控制器。
    *   **`kalman_filter.py`**: 用于状态估计和数据同化的工具。

### 其他关键目录

*   **`core/`**: SDK 的心脏，负责驱动仿真循环和管理整个系统状态。
*   **`factory/`**: 智能体的“兵工厂”，负责构建、训练和评估智能体，特别适用于强化学习应用。
*   **`workflows/`**: 将各种SDK功能串联起来以执行复杂的端到端任务（如系统辨识或控制器调优）的高级脚本。
*   **`preprocessing/`**: 用于清洗、准备和转换原始输入数据（如降雨时间序列、GIS数据）为SDK适用格式的工具。
*   **`utils/`**: 整个SDK中使用的辅助函数和工具的集合。

## 入门指南

要开始使用 `chs-sdk`，请从 `examples/` 目录中的示例开始。这些示例提供了如何为从单个水库到复杂河网的各种场景设置和运行仿真的实际演示。
