# 第十一章：输水系统 (2) - 有压管道 (Pipe)

上一章我们学习了如何模拟地表自由流动的明渠。本章，我们将探讨另一种重要的输水系统：在压力下输水的有压管道。有压管道是城市供水、排水以及长距离调水工程的生命线。

`chs-sdk` 提供了 `PipelineModel` 来模拟有压管道中的水流动态。与瞬时平衡流量的阀门模型不同，管道模型考虑了水的惯性，能够模拟流量从静止到加速，并最终在压力和摩擦力之间达到平衡的过程。

## 核心概念：有压管道模型

1.  **动量平衡 (Momentum Balance)**: `PipelineModel` 的核心是动量平衡。在每个时间步，它会计算作用在管道内水体上的合力。这个合力来自于管道两端的 **压差** 和管壁的 **摩擦损失**。
2.  **净水头 (Net Head)**: 净水头是压力差减去摩擦损失后剩余的有效水头。`净水头 = (入口压力 - 出口压力) - 摩擦水头损失`。
3.  **加速 (Acceleration)**: 根据牛顿第二定律 (F=ma)，净水头会使管道内的水体产生加速度，从而改变水流速度。
4.  **摩擦水头损失 (Friction Head Loss)**: 这是水流与管壁摩擦产生的能量损失。模型内置了两种常用的计算公式：
    *   **达西-魏斯巴赫 (Darcy-Weisbach)**: 使用 `friction_factor` (摩擦系数) 计算，物理意义更明确。
    *   **海曾-威廉 (Hazen-Williams)**: 使用 `hazen_williams_c` (C值系数) 计算，是给排水行业常用的经验公式。
5.  **水质追踪**: `PipelineModel` 还包含一个简单的一维平流模型，可以模拟溶质（如消毒剂或污染物）在管道中的输送过程。

## 场景：管道启动过程模拟

我们将模拟一个简单但经典的场景：
*   一个上游高位水库，水位恒定在50米。
*   一个下游水池，水位恒定在40米。
*   一根长1000米、直径0.5米的管道连接它们。
*   **目标**: 观察管道中的流量如何从0开始，由于10米的水位差（压力差）而加速，并最终因为摩擦损失的增加而达到一个稳定的流量值。

## 构建仿真脚本

### 组件解释

*   `PipelineModel`: 我们的核心组件。我们将使用达西-魏斯巴赫公式，并为其指定长度、直径和摩擦系数。
*   **边界条件**: 在这个例子中，我们将不使用水库模型，而是直接在循环中为管道的 `inlet_pressure` 和 `outlet_pressure` 提供恒定值，以更清晰地展示管道自身的动态特性。

### 完整脚本与运行

本章的完整示例代码已保存到以下文件中：

`source/ch11_pipe_simulation.py`

您可以直接运行此文件来查看仿真结果：

```bash
python source/ch11_pipe_simulation.py
```

### 预期结果

运行脚本后，您会看到一个图表，显示了流量（蓝线，左Y轴）和流速（红线，右Y轴）随时间的变化：
*   在仿真开始时，流量和流速都为0。
*   由于存在10米的净压差，水体开始加速，流量和流速迅速上升。
*   随着流速的增加，摩擦水头损失也随之增大（与流速的平方成正比）。
*   当摩擦水头损失逐渐增大到等于10米的压力差时，驱动水流的净水头变为0，加速度也变为0，此时流速和流量达到最大值并保持稳定。

这个过程清晰地展示了 `PipelineModel` 如何模拟真实的物理惯性和摩擦效应。
