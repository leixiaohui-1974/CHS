# 第三十章：高级主题 (2) - 创建你自己的物理模型

`chs-sdk` 的核心优势之一是其 **可扩展性**。尽管SDK内置了丰富的水利水文模型，但您总会遇到一些特殊的物理过程或业务逻辑，需要用自定义的模型来描述。

本章，我们将学习如何通过继承 `BaseModel` 基类，来创建您自己的、可以无缝集成到 `Host` 环境中的全新模型组件。

## 核心概念：`BaseModel` 接口

要创建一个自定义模型，您只需要创建一个继承自 `chs_sdk.modules.modeling.base_model.BaseModel` 的Python类，并实现几个关键方法：

1.  **`__init__(self, **kwargs)`**: 构造函数。在这里，您可以接收模型的参数（如几何尺寸、物理系数等），并初始化模型的内部状态变量。
2.  **`step(self, *args, **kwargs)`**: 核心计算方法。`Host` 在每个仿真时间步都会调用这个方法。您需要在这里实现模型在一个时间步内的所有物理计算或逻辑判断。它的输入参数可以根据您的模型需求自由定义。
3.  **`get_state(self)`**: 状态获取方法。这个方法需要返回一个字典，其中包含了您希望暴露给外部（如 `datalogger` 或其他模型）的所有状态变量。
4.  **`self.output`**: `BaseModel` 有一个名为 `output` 的标准属性。在 `step` 方法的最后，您应该将您模型最主要的输出值赋给 `self.output`。这样，`datalogger` 和其他组件就可以通过默认的 `value` 端口来连接它。

## 场景：创建一个水库蒸发模型

我们将创建一个 `EvaporationModel`，用于模拟水库的蒸发过程。
*   **输入**:
    1.  水库的水面面积 `surface_area` (m²)。
    2.  单位面积的蒸发速率 `evaporation_rate` (mm/day)。
*   **计算**: 模型将根据这两个输入，计算出总的蒸发损失流量 (m³/s)。
*   **输出**: 模型的 `output` 将是这个蒸发损失流量。

然后，我们会将这个自定义的蒸发模型，与一个水库模型 `LinearTank` 连接起来，观察蒸发对水库水位的长期影响。

## 构建自定义模型脚本

### 完整脚本与运行

本章的完整示例代码已保存到以下文件中：

`source/ch30_custom_model.py`

您可以直接运行此文件来查看仿真结果。脚本中定义了 `EvaporationModel` 类，并展示了如何将其实例化并与 `LinearTank` 连接。

```bash
python source/ch30_custom_model.py
```

### 预期结果

运行脚本后，您会看到一张图，显示了水库水位在一年中的变化。尽管没有任何入流和常规出流，水库的水位也会因为我们自定义的蒸发模型的持续作用而缓慢、线性地下降。

这个简单的例子展示了 `chs-sdk` 的开放性和灵活性。通过掌握创建自定义模型的方法，您可以将任何您需要的物理过程、业务逻辑或算法，封装成一个标准的、可重用的SDK组件。
