# 第十四章：水文系统 - 流域与河流

欢迎来到本指南的一个重要转折点。在此之前，我们关注的都是单个工程组件的详细模拟。从本章开始，我们将视野提升到整个 **流域 (Watershed)** 的宏观尺度，模拟自然界中“降雨-产流-汇流”的核心水文过程。

`chs-sdk` 为此提供了一个专用的、配置驱动的水文模拟引擎。与之前我们用Python代码连接智能体的方式不同，水文模拟引擎通过读取定义好的数据文件来构建和运行模型。

## 核心概念：流域水文模拟

1.  **配置驱动**: 这是与之前章节最大的不同。我们不再用 `host.add_agent` 和 `host.add_connection`，而是通过定义JSON文件来描述我们的系统。这使得分享和管理复杂流域模型变得更加容易。
    *   `topology.json`: 定义系统的拓扑结构，即哪些 **子流域 (Sub-basins)** 和 **水库 (Reservoirs)** 存在，以及它们是如何通过 **河段 (Reaches)** 连接的。
    *   `parameters.json`: 定义模型中每个组件的物理参数，例如子流域的产流模型参数、河段的汇流模型参数等。
    *   `timeseries.json`: 提供驱动模型的输入时间序列数据，主要是每个子流域的降雨和蒸发数据。
2.  **产流 (Runoff Generation)**: 这是指降雨落在子流域上，扣除蒸发、下渗等损失后，形成地表径流的过程。`chs-sdk` 支持多种产流模型，如 `XinanjiangModel`（新安江模型）。
3.  **汇流 (Routing)**: 这是指地表径流在河道网络中流动的过程。由于河道的调蓄作用，洪水波在向下游传播时会发生变形。`chs-sdk` 支持多种汇流模型，如 `MuskingumModel`（马斯京根模型）。
4.  **`Basin` 对象**: 这是水文模拟的总指挥。它负责读取上述配置文件，构建计算网络，并按正确的顺序（从上游到下游）依次计算每个单元的产流和汇流。

## 场景：一个简单的两流域系统

我们将模拟一个由两个子流域串联组成的简单系统：
*   `SubBasin1` 是上游的源头子流域。
*   `SubBasin1` 产生的径流通过一个河段 (`Reach1`) 流入 `SubBasin2`。
*   `SubBasin2` 自身也会因降雨而产流。
*   `SubBasin2` 的总出流（本地产流 + 上游来水）是整个流域的出口。
*   **目标**: 观察一场降雨事件后，两个子流域以及最终出口的流量变化过程。

## 构建仿真文件

本章的示例包含四个文件，它们都应放在 `source` 目录下。

1.  **`ch14_topology.json`**: 定义系统结构。
2.  **`ch14_parameters.json`**: 定义物理参数。
3.  **`ch14_timeseries.json`**: 定义输入数据。
4.  **`ch14_hydrology_simulation.py`**: 加载以上文件并运行仿真的脚本。

您可以直接运行主脚本来查看仿真结果：

```bash
python water_system_sdk/docs/guide/source/ch14/ch14_hydrology_simulation.py
```

### 预期结果

运行脚本后，您会看到一个图表，显示了两条流量过程线：
*   **`SubBasin1`**: 这条线显示了上游子流域的出流过程。它会有一个洪峰，然后通过马斯京根模型进行演算。
*   **`SubBasin2`**: 这条线是整个流域的总出口。它的流量过程是 `SubBasin2` 本地的产流，与从上游演算来的流量相叠加的结果，因此它的洪峰更大、更复杂。

本章向您展示了一个与之前完全不同的、数据驱动的建模范式，这是进行大规模、系统级水文模拟的基础。
