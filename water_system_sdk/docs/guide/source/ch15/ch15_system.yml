# 第十五章：一个完整的水库-闸门-渠道系统

components:
  # 1. 上游水库
  - name: upstream_reservoir
    type: LinearTank # 使用我们熟悉的线性水库模型
    properties:
      area: 10000.0
      initial_level: 25.0

  # 2. 控制器，目标是维持渠道出口流量为15m³/s
  - name: flow_controller
    type: PIDController
    properties:
      # 参数在 control_parameters.yaml 中定义
      setpoint: 15.0
    connections:
      # PID的测量值来自渠道的出口流量
      measured_value: downstream_channel.output

  # 3. 闸门，由PID控制
  - name: control_gate
    type: GateStationModel
    properties:
      num_gates: 2
      gate_width: 2.5
      discharge_coeff: 0.8
    connections:
      # 闸门上游水位来自水库
      upstream_level: upstream_reservoir.level
      # 闸门开度由PID控制器决定
      gate_opening: flow_controller.output

  # 4. 下游渠道
  - name: downstream_channel
    type: MuskingumChannelModel # 使用简化的马斯京根模型
    properties:
      K: 3600.0 # 1小时的传播时间
      x: 0.2
      dt: 60.0
      initial_inflow: 15.0
      initial_outflow: 15.0
    connections:
      # 渠道的入流来自闸门
      inflow: control_gate.output

# 定义需要记录和输出的变量
logging:
  - time
  - upstream_reservoir.level
  - control_gate.output
  - downstream_channel.output
  - flow_controller.output
