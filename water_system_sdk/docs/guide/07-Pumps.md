# 第七章：水力控制结构 (2) - 水泵 (Pump)

继上一章介绍了重力流控制结构（闸门）之后，本章我们将探讨另一种至关重要的水力结构：水泵。水泵通过消耗能量将水从低处输送到高处，或在有压管网中增压，是供水、排水和长距离调水工程的核心。

本章将教您如何使用 `chs-sdk` 来模拟一个由简单逻辑控制的泵站，该泵站负责将一个低位水池（sump）的水抽送到一个高位水库（reservoir）。

## 核心概念：水泵模型

`chs-sdk` 中的水泵模型主要围绕以下几个概念：

1.  **泵站 (`PumpStationModel`)**: 这是一个容器，可以包含一个或多个独立的水泵。在仿真中，我们通常直接与泵站模型交互。
2.  **泵特性曲线 (`curve_coeffs`)**: 这是水泵最重要的属性。它描述了水泵的扬程（Head, 水泵能提供的压力）与流量（Flow, Q）之间的关系。通常，流量越大，扬程越低。`chs-sdk` 使用一个二次多项式 `H = aQ² + bQ + c` 来表示这个曲线，`curve_coeffs` 参数对应的就是 `[a, b, c]`。
3.  **系统曲线**: 这是由管路系统的物理特性（高程差、管道摩擦等）决定的曲线，表示系统需要的扬程与流量的关系。
4.  **工作点 (Operating Point)**: 泵的实际工作点是其特性曲线与系统曲线的交点。`PumpStationModel` 会在每个时间步自动求解这个工作点，以计算出实际的流量。
5.  **控制**: 对水泵的控制通常是开关控制（开启或关闭某台水泵）或变频调速控制（调节水泵转速）。

## 场景：自动抽水系统

我们将模拟以下场景：
*   一个低位集水池 (`Sump`)，有持续的少量入流。
*   一个高位水库 (`Reservoir`)，我们希望向其供水。
*   一个连接两者的泵站 (`PumpStation`)。
*   **控制逻辑**: 当集水池的水位高于 **3米** 时，开启水泵抽水；当水位低于 **1米** 时，关闭水泵，以防抽空。

## 构建仿真脚本

### 组件解释

*   `FirstOrderStorageModel`: 我们将用两个该模型的实例分别代表低位集水池和高位水库。
*   `PumpStationModel`: 我们的核心组件。我们将为其配置泵的特性曲线。
*   **控制逻辑**: 为了简化，本章我们将不使用一个独立的控制器智能体，而是直接在主循环中用 `if/else` 语句实现控制逻辑，这能更清晰地展示水泵模型的输入和输出。

### 脚本实现

本章的完整示例代码已保存到以下文件中：

`source/ch07_pump_control.py`

您可以直接运行此文件来查看仿真结果：

```bash
python source/ch07_pump_control.py
```

代码的关键部分在于手动循环，我们在其中实现了控制逻辑：

```python
# ... 在循环内部 ...
# 获取当前集水池水位
sump_level = sump.get_port('value').value

# 控制逻辑
num_pumps_on = pump_station.get_port('num_pumps_on').value
if sump_level > 3.0:
    num_pumps_on = 1 # 水位高，开泵
elif sump_level < 1.0:
    num_pumps_on = 0 # 水位低，关泵

# 设置泵站的输入
pump_station.set_input('num_pumps_on', num_pumps_on)
# 扬程 = 出口水位 - 入口水位
pump_station.set_input('inlet_level', sump_level)
pump_station.set_input('outlet_level', reservoir.get_port('value').value)
```

### 预期结果

运行脚本后，您会看到：
*   集水池的水位（蓝线）由于有持续入流而不断上升。
*   当水位触及3米的红色虚线时，水泵启动（紫线从0变为1），开始抽水，此时水位开始下降。
*   当水位触及1米的绿色虚线时，水泵关闭（紫线从1变为0），水位再次开始上升。
*   这个启停过程会不断重复，形成一个典型的“滞回控制”或“起停控制”系统。
*   同时，您可以看到高位水库的水位（黑色虚线）在水泵工作时段内是持续上升的。

本章我们通过一个简单的例子介绍了水泵的建模和控制。在更复杂的系统中，您可以使用PID、MPC或更高级的调度智能体来控制泵站的运行。
