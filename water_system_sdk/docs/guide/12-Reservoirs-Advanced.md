# 第十二章：蓄水系统 (1) - 复杂水库与湖泊

在前面的所有章节中，为了简化，我们都假设水库是一个垂直的“水桶”（即`LinearTank`或`FirstOrderStorageModel`），其水位和蓄水量是简单的线性关系。然而，真实世界的水库和湖泊都是不规则的，其水面面积会随着水位的升高而增大。

本章，我们将学习如何使用 `chs-sdk` 中的 `NonlinearTank` 模型来更精确地模拟这种不规则形状的水库。

## 核心概念：水位-库容曲线

对于不规则的水库，其水位(Level)和库容(Volume/Storage)之间的关系不再是线性的。工程上，我们通常用一条 **“水位-库容曲线”** 来描述这种关系。这条曲线是通过地形测量数据计算得出的，它告诉我们在任意给定的水位下，水库的总蓄水量是多少。

`chs-sdk` 的 `NonlinearTank` 模型正是基于这个概念。它不假设一个固定的水面面积，而是直接使用您提供的水位-库容关系表。

## 场景：模拟不规则水库的蓄水过程

我们将模拟以下场景：
*   一个具有非线性水位-库容关系的不规则水库。
*   上游有一个变化的、模拟洪水的入流过程。
*   水库有一个恒定的生态基流作为出流。
*   **目标**: 观察不规则水库在经历一次洪水过程时的水位变化。

## 构建仿真脚本

### 组件解释

*   `NonlinearTank`: 本章的核心组件。它的关键输入是一个 `level_to_volume` 的NumPy数组。
*   `TimeSeriesDisturbance`: 我们将用它来模拟一个随时间变化的入流洪水过程。

### 完整脚本与运行

本章的完整示例代码已保存到以下文件中：

`source/ch12/ch12_reservoir_advanced.py`

您可以直接运行此文件来查看仿真结果：

```bash
python water_system_sdk/docs/guide/source/ch12/ch12_reservoir_advanced.py
```

### 预期结果

运行脚本后，您会看到：
*   **上图** 显示了水库的水位变化。在洪水来临时（入库流量增大），水位迅速上涨。洪峰过后，水位缓慢下降。由于水库的调蓄作用，水位的峰现时间会晚于流量的峰现时间。
*   **下图** 显示了我们定义的入库流量过程线，它是一个三角形的洪水波。

这个例子展示了 `NonlinearTank` 模型的强大之处。通过提供一条简单的曲线，我们就能准确地模拟不规则水库或湖泊的水量平衡，这是进行精确的洪水管理、水资源调度和生态模拟的基础。
