# 第十五章：模型动物园 - 快速组装系统

在前面的所有章节中，我们已经分别学习了 `chs-sdk` 中的各种核心组件：水库、闸门、水泵、渠道等等。现在，是时候像搭积木一样，把它们组合成一个更完整、更复杂的系统了。

本章，我们将学习一种更高效的建模方式：**配置驱动建模**。我们将不再使用Python代码逐个创建和连接智能体，而是通过一个 **YAML 配置文件** 来描述整个系统，然后使用一个通用的运行器脚本来启动仿真。

## 核心概念：配置即代码

当我们构建的系统越来越复杂时，用Python代码进行连接会变得非常冗长和繁琐。配置驱动的建模方式有几个核心优势：
1.  **可读性强**: YAML/JSON格式的配置文件像一张系统蓝图，清晰地展示了所有组件及其关系。
2.  **易于修改**: 改变一个参数或替换一个组件，只需要修改几行文本，而无需改动Python代码。
3.  **便于分享**: 一个配置文件就代表了一个完整的仿真案例，可以轻松地分享给他人。
4.  **支持多保真度**: 可以在同一个配置文件中为同一个组件定义不同复杂度的模型（如`steady_model`, `dynamic_model`），并在运行时选择使用哪一个。

`chs-sdk` 提供了一个通用的运行器 `run_case.py`，它能读取YAML配置文件并自动完成所有模型的初始化和连接工作。

## 场景：一个完整的水库-闸门-渠道系统

我们将用一个YAML文件来定义一个包含三个核心组件的系统：
*   一个上游 **水库** (`Reservoir`)。
*   一个由PID控制器控制的 **闸门** (`Gate`)，用于控制水库的下泄流量。
*   一条承接下泄流量的 **渠道** (`Channel`)。
*   **目标**: PID控制闸门，以维持渠道末端的流量为一个恒定值。

## 构建仿真文件

我们将创建两个文件，它们都应放在 `source` 目录下：

1.  **`ch15_system.yml`**: 定义系统所有组件、属性及连接。
2.  **`ch15_control_parameters.yml`**: 单独定义PID控制器的参数，便于调参。

### 运行仿真

我们不再需要编写新的Python脚本。直接在命令行中使用项目根目录下的 `run_case.py` 来运行我们的系统。

为了让 `run_case.py` 能够自动加载控制参数，我们需要将 `ch15_control_parameters.yml` **重命名** 为 `control_parameters.yaml`，并确保它和 `ch15_system.yml` 在同一个目录下。

然后，从项目根目录运行以下命令：

```bash
python run_case.py water_system_sdk/docs/guide/source/ch15_system.yml
```

### 预期结果

运行后，您会在命令行看到仿真的输出结果（一个表格）。如果将这些结果绘制成图表，您会看到：
*   `downstream_channel.output` (渠道出口流量) 会在PID的控制下，逐渐稳定在15 m³/s的设定值附近。
*   `control_gate.output` (闸门流量) 会相应地变化。
*   `upstream_reservoir.level` (水库水位) 会因为下泄而缓慢下降。

本章向您展示了 `chs-sdk` 的一种强大而高效的建模范式。对于大型复杂系统，使用配置文件进行建模是首选方法。这标志着我们对SDK核心组件的学习告一段落，下一部分我们将进入更高级的业务流程。
