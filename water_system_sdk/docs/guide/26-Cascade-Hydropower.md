# 第二十六章：场景实战 (4) - 梯级水电站群联合调度

我们继续进行综合应用场景的探索。本章，我们将 tackle 一个在水资源规划与管理领域中极为重要和经典的问题：**梯级水电站群的联合调度**。

当一条河流上建设了多个水电站时，它们就形成了一个“梯级”系统。这个系统的特点是，上游水电站的发电尾水，是下游水电站的入流。这种紧密的 **水力联系 (Hydraulic Linkage)** 意味着任何一个电站的运行，都会对下游所有电站的发电产生影响，并且这种影响会随着水流在河道中的传播而产生 **延迟 (Time Lag)**。因此，必须将它们作为一个整体来考虑，进行联合调度。

## 核心概念：水力联系与调度滞后

1.  **系统耦合 (System Coupling)**: 在梯级系统中，各个水电站不是独立的，而是通过河道水流紧密耦合在一起。上游的决策（放多少水）直接成为下游的输入（来多少水）。
2.  **调度滞后 (Dispatch Lag)**: 由于水流在河道中传播需要时间，上游的放水操作，需要经过数小时甚至数天才能到达下游水库。在制定下游水库的发电计划时，必须精确地预知上游的来水时间和流量。这正是水文/水动力学模型（如马斯京根或圣维南）在调度中扮演关键角色的原因。
3.  **联合优化目标**: 整个梯级系统调度的目标，通常是最大化系统在某个调度周期内的 **总发电量** 或 **总发电效益**，同时需要满足每个水库的水位、流量、出力等各种复杂约束。

## 场景：两级水电站的联动运行

我们将搭建一个简化的两级水电站系统，以直观地展示其联动特性：
*   **上游**: `Reservoir1` 和 `HydroStation1`。
*   **中间河道**: `RiverReach`，它将上游电站的尾水输送到下游。
*   **下游**: `Reservoir2` 和 `HydroStation2`。
*   **调度任务 (开环)**:
    1.  上游电站 `HydroStation1` 在白天（例如，8:00-20:00）按一个较大的流量发电，晚上则按较小的基流发电。
    2.  下游电站 `HydroStation2` 尝试执行完全相同的发电计划。
*   **目标**: 观察由于中间河道的存在，下游水库的入流过程与上游的出流过程有何不同，并分析这对于下游电站完成其发电计划会造成什么影响。

## 构建仿真脚本

### 组件解释

*   `LinearTank`: 两个实例，代表上下游水库。
*   `HydropowerStationModel`: 两个实例，代表上下游水电站。
*   `MuskingumChannelModel`: 代表中间的连接河道，它将模拟水流的传播延迟和洪峰演进。

### 完整脚本与运行

本章的完整示例代码已保存到以下文件中：

`source/ch26/ch26_cascade_hydropower.py`

您可以直接运行此文件来查看仿真结果：

```bash
python water_system_sdk/docs/guide/source/ch26/ch26_cascade_hydropower.py
```

### 预期结果

运行脚本后，您会看到：
*   **上图** 显示了流量的传播过程。上游电站的出流（蓝线）是一个方波，白天流量大，晚上流量小。而下游水库的入流（红虚线）则是经过河道演算后的结果，它相比蓝线，在时间上明显 **滞后**，并且波形变得平缓（**峰值被削减**）。
*   **下图** 显示了两个水库的水位变化。由于下游水库的入流存在滞后，而它的出流计划却是同步的，这会导致其水位在白天（来水少、出流多）下降，在晚上（来水多、出流少）上升，与上游水库的变化趋势可能完全相反。

这个例子直观地揭示了梯级调度问题的核心难点。一个真正的优化调度系统，必须精确地使用水文水动力学模型来预测未来的来水，才能制定出协调、高效的调度计划。
