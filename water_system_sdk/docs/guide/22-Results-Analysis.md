# 第二十二章：核心业务流程 (3) - 结果后处理与分析

运行仿真并得到一堆时序数据只是工作的一半。为了从仿真中获得真正的洞见，我们需要对结果进行 **后处理与分析 (Post-processing and Analysis)**。这包括计算量化的 **关键性能指标 (Key Performance Indicators, KPIs)**，以及创建能够清晰传达信息的图表。

本章，我们将学习如何利用 `pandas` 库，对我们之前章节中生成的仿真结果进行分析，并计算一些在水务和控制领域中常用的KPI。

## 核心概念：什么是KPI？

KPI是用来衡量一个系统性能的量化指标。对于一个水务控制系统，KPI可以分为两类：
1.  **控制性能KPI**: 衡量控制器的表现如何。
    *   **稳态误差 (Steady-State Error)**: 在系统稳定后，实际值与目标值的差距。越小越好。
    *   **超调量 (Overshoot)**: 响应过程中，实际值超过目标值的最大百分比。越小越好。
    *   **上升时间 (Rise Time)**: 系统从初始值上升到接近目标值（例如90%）所花费的时间。越快越好。
2.  **业务/物理KPI**: 衡量系统是否达成了其业务目标。
    *   **总泄流量/供水量 (Total Volume)**: 在一段时间内总共通过了多少水。
    *   **水量平衡误差 (Water Balance Error)**: `总入流 - 总出流 - 库容变化量`。理想情况下应为0，可以用来检验模型的物理保守性。
    *   **供水保证率**: 在需要供水的时段内，实际供水量满足需求的百分比。

## 场景：分析PID闸门控制器的性能

我们将重用第六章（闸门控制）的仿真结果。在那一章，我们的目标是使用PID控制器调节闸门，将水库水位维持在10米。现在，我们将加载那次仿真的结果数据，并回答以下问题：
1.  这个PID控制器的性能如何（稳态误差、超调量）？
2.  在整个仿真过程中，闸门总共向下游泄放了多少水量？

## 构建分析脚本

这次，我们不是运行一个新的仿真，而是编写一个分析脚本来读取和处理一个（假设的）已存在的CSV结果文件。

### 完整脚本与运行

本章的完整示例代码已保存到以下文件中：

`source/ch22/ch22_results_analysis.py`

您可以直接运行此文件来查看分析结果。该脚本为了能独立运行，在内部“伪造”了一份仿真结果数据。

```bash
python water_system_sdk/docs/guide/source/ch22/ch22_results_analysis.py
```

### 预期结果

运行脚本后，您会看到：
*   命令行的输出会清晰地列出计算得到的各项KPI的值。
*   弹出的图表不仅显示了水位的变化过程，还在右侧用一个文本框汇总了关键的KPI结果，并在图上用辅助线标出了峰值水位。

这种将计算结果与可视化结合的分析方式，是撰写专业、有说服力的工程分析报告的基础。本章学习的后处理技巧可以应用于我们之前所有章节的仿真结果中，帮助您更深入地理解您的水系统。
